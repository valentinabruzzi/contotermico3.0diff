class l{constructor(e,i){this.input=e,this.config={minChars:2,debounceTime:300,validateOnBlur:!0,noResultsText:"Nessun risultato...",loadingText:"Searching...",maxHeight:"max-h-80",...i},this.listElement=null,this.loaderElement=null,this.selectedIndex=-1,this.currentItems=[],this.currentData=[],this.suggestionSelected=!1,this.originalValue=e.value,this.init()}init(){this.input.addEventListener("input",()=>{this.suggestionSelected=!1,this.config.onInput&&this.config.onInput(this.input.value)}),this.input.addEventListener("keydown",e=>this.handleKeydown(e)),this.config.validateOnBlur&&this.input.addEventListener("blur",()=>{setTimeout(()=>{!this.suggestionSelected&&this.input.value!==this.originalValue&&(this.input.value="",this.config.onBlur&&this.config.onBlur())},200)})}showSuggestions(e){if(this.currentData=e,this.selectedIndex=-1,this.listElement?(this.listElement.classList.remove("hidden"),this.listElement.innerHTML=""):this.createList(),this.loaderElement){this.listElement.appendChild(this.loaderElement);return}if(e.length===0){this.showNoResults();return}this.currentItems=[],e.forEach((i,t)=>{const s=this.createListItem(i,t);this.listElement.appendChild(s),this.currentItems.push(s)})}createList(){this.listElement=document.createElement("ul"),this.listElement.id=this.config.listId,this.listElement.classList.add("absolute","bg-gray-800","text-gray-200","border","border-gray-600","rounded-md","mt-1","z-10",this.config.maxHeight,"w-full","overflow-y-auto","shadow-lg"),this.input.parentElement.appendChild(this.listElement)}createListItem(e,i){const t=document.createElement("li");return t.textContent=e[this.config.displayKey],t.classList.add("px-2","py-1.5","cursor-pointer","hover:bg-gray-700"),t.addEventListener("click",()=>{this.selectItem(e)}),t}showNoResults(){const e=document.createElement("li");e.textContent=this.config.noResultsText,e.classList.add("p-2","text-gray-400"),this.listElement.appendChild(e)}showLoader(){this.listElement||this.createList(),this.loaderElement||(this.loaderElement=document.createElement("li"),this.loaderElement.classList.add("p-2","text-gray-300","flex","items-center","justify-center"),this.loaderElement.innerHTML=`
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg> ${this.config.loadingText}
            `),this.listElement.innerHTML="",this.listElement.appendChild(this.loaderElement),this.listElement.classList.remove("hidden")}hideLoader(){this.loaderElement&&(this.loaderElement.remove(),this.loaderElement=null)}selectItem(e){this.input.value=e[this.config.displayKey],this.suggestionSelected=!0,this.originalValue=e[this.config.displayKey],this.hideList(),this.config.onSelect&&this.config.onSelect(e),this.originalValue=this.input.value}hideList(){this.listElement&&(this.listElement.classList.add("hidden"),this.listElement.innerHTML="")}handleKeydown(e){if(this.currentItems.length!==0)if(e.key==="ArrowDown")e.preventDefault(),this.selectedIndex=(this.selectedIndex+1)%this.currentItems.length,this.highlightItem();else if(e.key==="ArrowUp")e.preventDefault(),this.selectedIndex=(this.selectedIndex-1+this.currentItems.length)%this.currentItems.length,this.highlightItem();else if(e.key==="Enter"){if(e.preventDefault(),this.selectedIndex>=0){const i=this.currentData[this.selectedIndex];this.selectItem(i)}}else e.key==="Escape"&&this.hideList()}highlightItem(){if(this.currentItems.forEach(e=>e.classList.remove("bg-gray-300")),this.selectedIndex>=0){const e=this.currentItems[this.selectedIndex];e.classList.add("bg-gray-300"),e.scrollIntoView({block:"nearest",behavior:"smooth"})}}destroy(){this.listElement&&this.listElement.remove(),this.loaderElement&&this.loaderElement.remove()}static closeOnClickOutside(){document.addEventListener("click",function(e){document.querySelectorAll('ul[id$="-suggestions"]').forEach(t=>{t.contains(e.target)||t.classList.add("hidden")})})}}export{l as A};
